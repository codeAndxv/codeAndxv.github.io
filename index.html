<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-《奇异人生》有感" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/%E3%80%8A%E5%A5%87%E5%BC%82%E4%BA%BA%E7%94%9F%E3%80%8B%E6%9C%89%E6%84%9F/" class="article-date">
  <time datetime="2020-08-02T14:04:36.462Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2020.04.09</em></p>
<p>warn: 本文章涉及到大量剧透，请通过后再进行阅读。</p>
<p>这个游戏剧情是围绕麦克斯和克洛伊进行的。一开始麦克斯·考非尔德（Maxine Caulfield）在上艺术课时出现幻视，来到了某个灯塔旁并目击到巨型龙卷风摧毁小镇的全过程。然后麦克斯使用时间回溯能力拯救了一个原本被击杀的女孩，后被发现是自己儿时好友克洛伊（Chloe Price）。这个顺序给了我很大的错觉，我一直认为龙卷风是原本就会发生的，而麦克斯获得时间回溯能力就是为了组织龙卷风的发生或者让所有的居民都转移走。直到最后麦克斯自己说龙卷风、暴雪、日蚀都是因为自己使用时间回溯导致的，我才明白原来是这样。</p>
<h4 id="其中给我触动比较大的剧情有几个"><a href="#其中给我触动比较大的剧情有几个" class="headerlink" title="其中给我触动比较大的剧情有几个"></a>其中给我触动比较大的剧情有几个</h4><ul>
<li>麦克斯回到过去拯救克洛伊的父亲威廉（William Price），却导致了克洛伊遭遇车祸，全身瘫痪，呼吸衰竭。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/%E3%80%8A%E5%A5%87%E5%BC%82%E4%BA%BA%E7%94%9F%E3%80%8B%E6%9C%89%E6%84%9F/" data-id="ckdd5qtiq0005gstd19z67lnj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-目前的反思和未来的计划" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/%E7%9B%AE%E5%89%8D%E7%9A%84%E5%8F%8D%E6%80%9D%E5%92%8C%E6%9C%AA%E6%9D%A5%E7%9A%84%E8%AE%A1%E5%88%92/" class="article-date">
  <time datetime="2020-08-02T14:03:39.813Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2020.04.22</em></p>
<h3 id="目前的反思"><a href="#目前的反思" class="headerlink" title="目前的反思"></a>目前的反思</h3><p>目前已经沉迷游戏，荒废学习两个月之久。一方面是因为新冠肺炎，还有就是自己内心是不想去学习。现在的状态是每天呆在出租屋里，一天吃两顿饭，玩着游戏（网络游戏以及单机游戏），不知不觉一天就过去了。今年可能就真的荒废了。虽然说我的积蓄足够我支撑现在的生活一年，但我真的能这样下去吗，不能的。</p>
<p>老妈之前就说过一天一天过的真的很快。 可是老妈，大道理我都懂，但我现在的内心是真的不想奋斗了。<del>就算是努力奋斗也买不起房子</del>，尤其是每次准备面试都被pass掉，我的内心真的不强大。</p>
<p><strong>但是</strong>荒废真的该适可而止了，再这样下去真的就完了。我不想去打工，做着我不喜欢的工作内容，每天996这种。就算是做不了什么大事，也要做一些自己喜欢的事情以及对别人有益的事情。学一些新的技术，看一些新的书，都是进步，而每天这样沉迷游戏，真的就废掉了。</p>
<h3 id="未来的计划"><a href="#未来的计划" class="headerlink" title="未来的计划"></a>未来的计划</h3><p>今年年初制定的计划，上半年找工作，下半年准备考研。现在看来计划很难实现了。找不到合适的工作，考研竞争压力非常大。我应该迎难而上。</p>
<p>分析一下目前为什么会这样的原因，因为没有切实的工作计划，没有共同进步的同伴。每天睡到自然醒，晚上3，4点睡觉。不知不觉一天就结束了，但这不是我应该有的样子。</p>
<p>作息表（now）</p>
<table>
<thead>
<tr>
<th>时间</th>
<th>周一到周六</th>
</tr>
</thead>
<tbody><tr>
<td>8：00</td>
<td>起床</td>
</tr>
<tr>
<td>8：00-8：30</td>
<td>洗漱+吃饭</td>
</tr>
<tr>
<td>8：30-9：10</td>
<td>背单词</td>
</tr>
<tr>
<td>9：20-10：00</td>
<td>学习数学</td>
</tr>
<tr>
<td>10：10-10：50</td>
<td>学习数学</td>
</tr>
<tr>
<td>10：50-11：10</td>
<td>休息时间</td>
</tr>
<tr>
<td>11：20-12：00</td>
<td>学习编程技术</td>
</tr>
<tr>
<td>12：00-13：30</td>
<td>午饭+午休</td>
</tr>
<tr>
<td>13：30-14：10</td>
<td>阅读书籍</td>
</tr>
<tr>
<td>14：20-15：00</td>
<td>学习别人的项目</td>
</tr>
<tr>
<td>15：10-15：50</td>
<td>学习编程技术</td>
</tr>
<tr>
<td>15：50-16：10</td>
<td>休息时间</td>
</tr>
<tr>
<td>16：10-16：50</td>
<td>阅读书籍</td>
</tr>
<tr>
<td>17：50—17：40</td>
<td>学习编程技术</td>
</tr>
<tr>
<td>17：50-18：30</td>
<td>阅读书籍</td>
</tr>
<tr>
<td>18：30-19：30</td>
<td>吃饭+休息</td>
</tr>
<tr>
<td>19：30-20：10</td>
<td>晚一</td>
</tr>
<tr>
<td>20：20-21：00</td>
<td>晚二</td>
</tr>
<tr>
<td>21：00-22：30</td>
<td>自由娱乐+洗漱</td>
</tr>
</tbody></table>
<p>作息表（六月后）</p>
<table>
<thead>
<tr>
<th>时间</th>
<th>周一到周六</th>
</tr>
</thead>
<tbody><tr>
<td>8：00</td>
<td>起床</td>
</tr>
<tr>
<td>8：00-8：30</td>
<td>洗漱+吃饭</td>
</tr>
<tr>
<td>8：30-9：10</td>
<td>背单词</td>
</tr>
<tr>
<td>9：20-10：00</td>
<td>学习数学</td>
</tr>
<tr>
<td>10：10-10：50</td>
<td>学习</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/%E7%9B%AE%E5%89%8D%E7%9A%84%E5%8F%8D%E6%80%9D%E5%92%8C%E6%9C%AA%E6%9D%A5%E7%9A%84%E8%AE%A1%E5%88%92/" data-id="ckdd5qtix000bgstdat6oa4sk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-spring cloud gateway 使用 nacos作为动态路由配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/spring%20cloud%20gateway%20%E4%BD%BF%E7%94%A8%20nacos%E4%BD%9C%E4%B8%BA%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2020-08-02T14:02:27.002Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2020.04.04</em></p>
<h2 id="技术介绍"><a href="#技术介绍" class="headerlink" title="技术介绍"></a>技术介绍</h2><p>使用微服务架构的工程，不同的服务会有不同的服务地址。而且有时为了负载均衡，相同的服务也会有不同的服务地址。</p>
<h4 id="网关的定义、职能"><a href="#网关的定义、职能" class="headerlink" title="网关的定义、职能"></a>网关的定义、职能</h4><p>网关是作为API架构，用来管理授权、地址路由、访问控制和流量限制。网关的位置处于应用程序或服务之前的系统，用来管理授权、访问控制和流量限制等等。</p>
<p>如果不使用网关，会有如下的问题：</p>
<ol>
<li>客户端会多次请求不同的微服务，增加了客户端的复杂性。</li>
<li>重构困难，微服务会随时重新划分功能模块</li>
<li>认证复杂，每个服务都想要独立认证</li>
</ol>
<p>以未使用网关的微服务为例，所有的API接口都需要进行身份认证，权限控制和流量控制等等。网关其实就是把API所需要的公共的功能给抽象出来放在一起的一个设计。</p>
<h4 id="spring-cloud-gateway"><a href="#spring-cloud-gateway" class="headerlink" title="spring cloud gateway"></a>spring cloud gateway</h4><p>类似的网关产品还有：zuul、zuul2、kong、nginx等</p>
<h4 id="nacos-职能"><a href="#nacos-职能" class="headerlink" title="nacos 职能"></a>nacos 职能</h4><ul>
<li>服务发现和服务健康监测</li>
<li>动态配置服务</li>
<li>动态DNS服务</li>
<li>服务及其元数据管理</li>
</ul>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h4 id="nacos搭建"><a href="#nacos搭建" class="headerlink" title="nacos搭建"></a>nacos搭建</h4><p>环境是linux，使用docker来运行nacos，需自行搜索安装git、docker等软件</p>
<ul>
<li>clone 项目<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;nacos-group&#x2F;nacos-docker.git</span><br><span class="line">cd nacos-docker</span><br></pre></td></tr></table></figure></li>
<li>单机模式 Derby<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f example&#x2F;standalone-derby.yaml up</span><br></pre></td></tr></table></figure>
<h4 id="项目代码"><a href="#项目代码" class="headerlink" title="项目代码"></a>项目代码</h4>代码就不在文章中贴了，已上传至github，<a target="_blank" rel="noopener" href="https://github.com/codeAndxv/blog-source-code/tree/master/spring-cloud-gateway-nacos">spring-cloud-gateway-nacos</a></li>
</ul>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><h5 id="Nacos中下发Spring-Cloud-Gateway的路由配置"><a href="#Nacos中下发Spring-Cloud-Gateway的路由配置" class="headerlink" title="Nacos中下发Spring Cloud Gateway的路由配置"></a>Nacos中下发Spring Cloud Gateway的路由配置</h5><ol>
<li><p>打开浏览器访问URL:<a target="_blank" rel="noopener" href="http://localhost:8848/nacos/index.html">http://localhost:8848/nacos/index.html</a> ,Nacos的管控平台如下所示:<br><img src="https://s1.ax1x.com/2020/04/04/GwakSU.png" alt="GwakSU.png"></p>
</li>
<li><p>在Nacos的配置列表点击+按钮，下发Spring Cloud Gateway的路由配置，如下所示:<br><img src="https://s1.ax1x.com/2020/04/04/GwaPYV.png" alt="GwaPYV.png"><br>配置如下：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;filters&quot;: [],</span><br><span class="line">    &quot;id&quot;: &quot;jd_route&quot;,</span><br><span class="line">    &quot;order&quot;: 0,</span><br><span class="line">    &quot;predicates&quot;: [&#123;</span><br><span class="line">        &quot;args&quot;: &#123;</span><br><span class="line">            &quot;pattern&quot;: &quot;&#x2F;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;name&quot;: &quot;Path&quot;</span><br><span class="line">    &#125;],</span><br><span class="line">    &quot;uri&quot;: &quot;http:&#x2F;&#x2F;www.douban.com&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>启动spring-cloud-gateway-nacos项目</li>
<li>通过访问<a target="_blank" rel="noopener" href="http://localhost:18071/">http://localhost:18071/</a> ,可以转发到豆瓣主页</li>
</ol>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>spring-cloud-gateway不会删除匹配到的部分，比方说如果访问的<a target="_blank" rel="noopener" href="http://localhost:18071/douban,%E4%BC%9A%E8%B7%B3%E8%BD%AC%E5%88%B0http://www.douban.com/douban%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%AD%98%E5%9C%A8%E5%B0%B1%E4%BC%9A%E8%B7%B3%E5%88%B0%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2%E3%80%82">http://localhost:18071/douban,会跳转到http://www.douban.com/douban，如果不存在就会跳到错误页面。</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这种方式是显示的注册监听器，也可以使用<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/nacos-spring.html">Nacos Spring</a>提供的注解@NacosConfigListener的方式。</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a target="_blank" rel="noopener" href="https://xujin.org/blog/scg-nacos-01/">使用Nacos实现Spring Cloud Gateway的动态路由|</a><br><a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/nacos-spring.html">nacos文档</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/spring%20cloud%20gateway%20%E4%BD%BF%E7%94%A8%20nacos%E4%BD%9C%E4%B8%BA%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE/" data-id="ckdd5qtip0004gstd0hp87hje" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-阅读《精通比特币》的若干纪录" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/%E9%98%85%E8%AF%BB%E3%80%8A%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81%E3%80%8B%E7%9A%84%E8%8B%A5%E5%B9%B2%E7%BA%AA%E5%BD%95/" class="article-date">
  <time datetime="2020-08-02T14:01:26.427Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2020.03.23</em></p>
<h3 id="解锁和锁定脚本的单独执行"><a href="#解锁和锁定脚本的单独执行" class="headerlink" title="解锁和锁定脚本的单独执行"></a>解锁和锁定脚本的单独执行</h3><p>在最初版本的比特币客户端中，解锁和锁定脚本是以连锁的形式存在，并被依次执行的。出于安全因素考虑，在2010 年比特币开发者们修改了这个特性——因为存在“允许异常解锁脚本推送数据入栈并且污染锁定脚本”的漏洞。而在当前的方案中，这两个脚本是随着堆栈的传递被分别执行的。下面将会详细介绍。</p>
<p>首先，使用堆栈执行引擎执行解锁脚本。如果解锁脚本在执行过程中未报错（例如：没有“悬挂”操作码），则复制主堆栈（而不是备用堆栈），并执行锁定脚本。如果从解锁脚本中复制而来的堆栈数据执行锁定脚本的结果为“TRUE”，那么解锁脚本就成功地满足了锁定脚本所设置的条件，因此，该输入是一个能使用该UTXO的有效授权。如果在合并脚本后的结果不是”TRUE“以外的任何结果，输入都是无效的，因为它不能满足UTXO中所设置的使用该笔资金的条件。</p>
<h3 id="Merkle树和简单支付验证（SPV）"><a href="#Merkle树和简单支付验证（SPV）" class="headerlink" title="Merkle树和简单支付验证（SPV）"></a>Merkle树和简单支付验证（SPV）</h3><p>Merkleblock消息包含区块头和一条连接目标交易与Merkle根的Merkle路径。SPV节点能够使用该路径找到与该交易相关的区块，进而验证对应区块中该交易的有无。</p>
<h3 id="网络节点发现"><a href="#网络节点发现" class="headerlink" title="网络节点发现"></a>网络节点发现</h3><p>首先思考一个问题，一个新搭建好的Bitcoin节点如何连接到别的Bitcoin节点，也就是如何知道别的Bitcoin的地址。有两个方法，一个是通过向类似于DNS的服务器发送请求常用可靠节点的列表，还有一个就是自己提供Bitcoin节点的列表。</p>
<p>已知节点地址后，开始连接过程，“握手通讯”过程协议如下：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>nversion</td>
<td>使用的比特币P2P协议的版本</td>
</tr>
<tr>
<td>nLocalServices</td>
<td>支持的本地服务列表</td>
</tr>
<tr>
<td>nTime</td>
<td>当前时间</td>
</tr>
<tr>
<td>addrYou</td>
<td>当前节点可见的远程节点的IP地址</td>
</tr>
<tr>
<td>addrMe</td>
<td>本地节点所发现的本机IP地址</td>
</tr>
<tr>
<td>subver</td>
<td>指示当前节点运行的软件类型的子版本号</td>
</tr>
<tr>
<td>BaseHeight</td>
<td>当前节点区块链的区块高度</td>
</tr>
</tbody></table>
<h3 id="区块传播和“库存交换”"><a href="#区块传播和“库存交换”" class="headerlink" title="区块传播和“库存交换”"></a>区块传播和“库存交换”</h3><p>思考一个问题，一个新节点或者离线一段时间的节点加入到网络中，如何获取自己没有的哪些区块？</p>
<p>对等节点之间会通过<code>getblocks</code>消息来交换所存储的最新区块信息，最新区块指纹（哈希）不同的节点会根据区块高度来判断是否向对方申请区块，保证分叉的区块也会被传播。（这本书并没有详细说明什么时候会发送getblocks消息，而且这种方式也有些被动。应该还有一个方式，当节点接收到新区块时，主动推送给连接的节点）</p>
<h3 id="关于创世区块的秘密"><a href="#关于创世区块的秘密" class="headerlink" title="关于创世区块的秘密"></a>关于创世区块的秘密</h3><p>先给出前提，bitcoin中有两种交易，一种是coinbase交易，这种交易可以没有输入，用于给矿工的奖励。另一种是普通的交易，有输入和输出，输入之和可以大于输出之和，其中的差就是给矿工的交易费。</p>
<p>交易的格式如下：</p>
<table>
<thead>
<tr>
<th>字节长度</th>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>4</td>
<td>交易版本号</td>
<td>明确这笔交易参照的规则</td>
</tr>
<tr>
<td>1-9</td>
<td>输入计数器</td>
<td>包含的交易输入数量</td>
</tr>
<tr>
<td>不定</td>
<td>交易输入</td>
<td>一个或多个交易输入</td>
</tr>
<tr>
<td>1-9</td>
<td>输出计数器</td>
<td>包含的交易输出数量</td>
</tr>
<tr>
<td>不定</td>
<td>交易输出</td>
<td>一个或多个交易输出</td>
</tr>
<tr>
<td>4</td>
<td>锁定时间</td>
<td>一个区块号或UNIX时间戳</td>
</tr>
</tbody></table>
<p>交易输入的结构如下：</p>
<table>
<thead>
<tr>
<th>字节长度</th>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>32</td>
<td>交易哈希值</td>
<td>固定为全0</td>
</tr>
<tr>
<td>4</td>
<td>输出索引</td>
<td>固定为全1</td>
</tr>
<tr>
<td>1-9</td>
<td>Coinbase脚本长度</td>
<td>coinbase的脚本字节长度</td>
</tr>
<tr>
<td>不定</td>
<td>coinbase脚本</td>
<td>coinbase脚本，可以任意填充</td>
</tr>
<tr>
<td>4</td>
<td>序列号</td>
<td>固定值0xFFFFFFFF</td>
</tr>
</tbody></table>
<p>交易输出的结构：</p>
<table>
<thead>
<tr>
<th>字节长度</th>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>8</td>
<td>总量</td>
<td>用聪表示的比特币值</td>
</tr>
<tr>
<td>1-9</td>
<td>锁定脚本大小</td>
<td>用字节表示的后面的锁定脚本长度</td>
</tr>
<tr>
<td>不定</td>
<td>锁定脚本</td>
<td>一个定义了支付输出所需条件的脚本</td>
</tr>
</tbody></table>
<p>两种交易的结构是一样的，不同的就是coinbase交易可以没有输入。</p>
<p>然后给出创世区块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">&quot;hash&quot; : &quot;000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f&quot;,</span><br><span class="line">&quot;confirmations&quot; : 308321,</span><br><span class="line">&quot;size&quot; : 285,</span><br><span class="line">&quot;height&quot; : 0,</span><br><span class="line">&quot;version&quot; : 1,</span><br><span class="line">&quot;merkleroot&quot; : &quot;4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b&quot;,</span><br><span class="line">&quot;tx&quot; : [ &quot;4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b&quot; ],</span><br><span class="line">&quot;time&quot; : 1231006505,</span><br><span class="line">&quot;nonce&quot; : 2083236893,</span><br><span class="line">&quot;bits&quot; : &quot;1d00ffff&quot;,</span><br><span class="line">&quot;difficulty&quot; : 1.00000000,</span><br><span class="line">&quot;nextblockhash&quot; : &quot;00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048&quot;&#125;&#96;&#96;</span><br></pre></td></tr></table></figure>

<p>可以看到创世区块只有一个交易，就是coinbase交易。</p>
<p>然后给出这个coinbase交易的<code>input script</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NONSTANDARD    </span><br><span class="line">04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73</span><br></pre></td></tr></table></figure>
<p>decode后就是就是<code>��EThe Times 03/Jan/2009 Chancellor on brink of second bailout for banks。</code></p>
<p>这句话是英国《泰晤士报》当天的头版文章标题。<br><img src="http://129.28.154.71:8503/upload/2020/3/56z78h9i5pg5erdou6gjbgmmfejc15-d9186bfeb058489f949d1d546d035618.jpg" alt="56z78h9i5pg5erdou6gjbgmmfejc15.jpg"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>整体读下来，bitcoin的设计并不复杂，也很好理解。</p>
<h3 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h3><p><a target="_blank" rel="noopener" href="https://www.gitbook.com/book/wizardforcel/masterbitcoin2cn">《精通比特币》</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/%E9%98%85%E8%AF%BB%E3%80%8A%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81%E3%80%8B%E7%9A%84%E8%8B%A5%E5%B9%B2%E7%BA%AA%E5%BD%95/" data-id="ckdd5qtj0000cgstdheh19i3t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2020年年初随想 关于目前自身状态和以后的发展的若干想法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/2020%E5%B9%B4%E5%B9%B4%E5%88%9D%E9%9A%8F%E6%83%B3%20%E5%85%B3%E4%BA%8E%E7%9B%AE%E5%89%8D%E8%87%AA%E8%BA%AB%E7%8A%B6%E6%80%81%E5%92%8C%E4%BB%A5%E5%90%8E%E7%9A%84%E5%8F%91%E5%B1%95%E7%9A%84%E8%8B%A5%E5%B9%B2%E6%83%B3%E6%B3%95/" class="article-date">
  <time datetime="2020-08-02T13:59:57.181Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2020.03.22</em></p>
<h2 id="2020年-不平凡的一年"><a href="#2020年-不平凡的一年" class="headerlink" title="2020年 不平凡的一年"></a>2020年 不平凡的一年</h2><p>2020年是我的本命年，也是不幸的一年。不知道是我太过敏感，2008年汶川大地震，同样是一场影响千家万户的灾难。19年末出现的新型管状性肺炎仿佛标志着磨难的开始，疫情不但意味着痛苦和死亡。同时为了控制疫情的传播，人们被困在家里。流动性的失去也意味着消费产业无法获得他们预期的利润。覆巢之下，焉有完卵。大量的打工者也失去了他们的岗位。没有收入，人们就不敢消费，如此恶性循环，如果不加以干涉调整，经济会出现大问题。</p>
<h2 id="最近的困惑"><a href="#最近的困惑" class="headerlink" title="最近的困惑"></a>最近的困惑</h2><p>我越来越喜欢一个人呆着，越来越不喜欢和人交流。但这种方式不太可能，按照传统的生活方式，人需要找到配偶来繁衍后代，人需要和别人交流、交易才能更好的发挥每个人的潜能和专场。人与人的沟通交流很重要。</p>
<p>从五面阿里失败后，我再次对开发这条路产生了动摇。这两年来，我不可谓是不努力，但还是失败了。开发在国内，到了30岁会因为年龄出现巨大的阻力。每天都在出现新的技术，以往的经验因此被废弃。越来越多的人参与到软件这个方面，也使得竞争压力越来越大。资本家逐利，更趋向于选择更廉价更耐用的劳动力。</p>
<p>所以我被是否要选择其他路的问题所困惑。如果要选择其他路，要选择什么路，现在大家都在向互联网这个方面靠，说明这是个大方向、趋势。如果还是继续开发这条路，我又不甘心。</p>
<h2 id="关于自身状态"><a href="#关于自身状态" class="headerlink" title="关于自身状态"></a>关于自身状态</h2><p>我目前是比较堕落的，现在每天在租的房子里，要么看小说，要么打游戏。饭也是每天吃一两顿，不按时吃。之前在家，每天睡到11点起，不与人交流，父母也没有说过什么。可能也是跟自己现在能够独立有部分的关系，父母也不会说我什么。但我深知这种状态是不行的，我还是需要回归到正常的生活状态。就算是真的找不到工作，也要让自己有所事事。</p>
<p>在目前的情况下，需要给自己设立目标，完成目标。比如使用<code>Trello</code>等项目流程管理方法来激励自己完成目标。</p>
<h2 id="预期目标"><a href="#预期目标" class="headerlink" title="预期目标"></a>预期目标</h2><p>今年我有几个小目标，下面先列出，然后加以分析</p>
<ul>
<li>5月之前找到一份工作，范围是后端开发和区块链开发</li>
<li>学习视频制作以及机器学习方面的知识</li>
<li>考上南京大学研究生，目前待定范围是计算机专业</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/2020%E5%B9%B4%E5%B9%B4%E5%88%9D%E9%9A%8F%E6%83%B3%20%E5%85%B3%E4%BA%8E%E7%9B%AE%E5%89%8D%E8%87%AA%E8%BA%AB%E7%8A%B6%E6%80%81%E5%92%8C%E4%BB%A5%E5%90%8E%E7%9A%84%E5%8F%91%E5%B1%95%E7%9A%84%E8%8B%A5%E5%B9%B2%E6%83%B3%E6%B3%95/" data-id="ckdd5qtie0000gstd9o91a1m6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-区块链数据上链服务架构设计" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%95%B0%E6%8D%AE%E4%B8%8A%E9%93%BE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" class="article-date">
  <time datetime="2020-08-02T13:58:12.415Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2020.01.03</em></p>
<p>本文介绍了如何一步一步设计出高性能、高并发的异步上链工程。</p>
<p><img src="https://img.hacpai.com/bing/20190108.jpg?imageView2/1/w/960/h/540/interlace/1/q/100"> </p>
<p><em>背景：这个工程基本上一直是我自己在做。从半年前做出来的勉强满足需求，到现在设计出自己满意的样子，也体现出了自己的架构设计和并发编程能力的提高。</em><br>下面按照时间顺序，是一步一步设计实现的</p>
<h4 id="1-工程需求"><a href="#1-工程需求" class="headerlink" title="1. 工程需求"></a>1. 工程需求</h4><p>工程是实现一个能够从缓存表中取出数据，发送到区块链上。从工程的目的来看，好像很简单。但是需要保证交易的时间顺序，以及失败重试。同时要保证高性能，高并发。<br>还有一个业务方面的需求，因为区块链的特殊性，一些有互斥操作的数据同时上链，会出现无效的情况。所以尽量保证互斥数据同时上链时，只有前面一个数据成功，或者前面一个数据失败次数耗尽时，才让后面的数据进行上链操作。</p>
<h4 id="2-半年前的实现"><a href="#2-半年前的实现" class="headerlink" title="2.  半年前的实现"></a>2.  半年前的实现</h4><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/ntp8Wq"><img src="https://s2.ax1x.com/2019/09/09/ntp8Wq.png" alt="ntp8Wq.png"></a></p>
<p>大致介绍一下，首先从1获取待同步到链上的数据，判断有互斥的数据是否已经在上链过程中。如果已经在上链过程中，就取下一条数据进行判断。如果没有在上链过程中，就进下一步 异步上链。启动另外一个线程来与链交互，如果成功就将互斥的数据标识从保存上链的标识集合中删除，并更新数据表中对应的数据状态。</p>
<p>先思考一下，这个设计怎么样，在什么情况下会出现很大的问题？</p>
<p>直接说明，这个设计很差，即使在正常运行的情况下，也会出现一些小问题。<br>如果一切正常，也会导致本该后上链的数据先上链。如果同样一堆在一起的互斥数据同时上链，想一下，第一个上链了，成功了，花了几秒钟，然后第二、第三、第四都过去了。这个时候，第一条数据的回调将互斥标识删除，第五条数据又上链了。beng。再考虑如果上链失败的情况，步骤6更新数据库中对应的数据。步骤1会重新取数据进行上链重试，但是这个上链顺序完全就乱掉了。</p>
<p>在考虑一下极端的情况，一下子2000条非互斥的数据同时上链。这个设计根本没有控制并发量，很容易导致一些回调线程失败，或者太多个链接到chain，导致chain超时。</p>
<p>如果回调失败，会导致更严重的问题。保存互斥数据的集合不会删除对应的互斥标识，导致所有的互斥数据都不能再上链。<br>所以这个设计问题很大。<br>更不要说，如果服务器突然挂掉，根本没有做任何关于数据备份和还原的东西。</p>
<h4 id="3-初步设计"><a href="#3-初步设计" class="headerlink" title="3. 初步设计"></a>3. 初步设计</h4><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/nanIAA"><img src="https://s2.ax1x.com/2019/09/10/nanIAA.png" alt="nanIAA.png"></a><br>将上链功能分成三个部分，client，middle和server。如图所示，middle有200+1个队列。前面200个队列用于存放first-wait-sync-chain-data，互斥的数据放在同一个队列中。队列数量可根据自己的情况来设置。</p>
<p>从server层将互斥操作排除<br>保证数据从早到晚依次上链</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%95%B0%E6%8D%AE%E4%B8%8A%E9%93%BE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" data-id="ckdd5qtiv0008gstd56dy4mok" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java数据操作基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/java%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2020-08-02T13:57:16.294Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2019.12.31</em></p>
<p><img src="https://img.hacpai.com/bing/20190515.jpg?imageView2/1/w/960/h/540/interlace/1/q/100"> </p>
<p><em>今天说一下关于java基础的东西。昨天顺手写了一个<a target="_blank" rel="noopener" href="https://github.com/codeAndxv/blog-test/blob/master/src/main/java/com/dudu/mutil/unsafe/Test.java">多线程操作例子</a>，运行了一下居然发现运行没错。非常超出我的预料，因为这种操作几乎一定会出现错误。猜测为什么会没有出错的原因，可能是因为传参方式的问题。</em></p>
<h3 id="1-java的传参方式"><a href="#1-java的传参方式" class="headerlink" title="1. java的传参方式"></a>1. java的传参方式</h3><p>博主最先学习的是c系列，然后学的才是java。c系列是既有值传递又有引用传递。 而对java传参方式已经有些模糊。</p>
<p>说一下结论，java中只有值传递，传递的只有值的副本。</p>
<p>写<a target="_blank" rel="noopener" href="https://github.com/codeAndxv/blog-test/tree/master/src/main/java/com/dudu/func">三个方法调用的例子</a>，观察这三个例子的这三个例子的结果分别是20 10； 20 10； 以及20 20。 先思考一下为什么？</p>
<p>为了更好的理解，分析一下jvm。<br><strong>jvm的内存分为虚拟机栈，本地方法栈，程序计数器，方法区以及堆。</strong></p>
<p>更详细的解释：<a target="_blank" rel="noopener" href="https://juejin.im/post/5bce68226fb9a05ce46a0476">这一次，彻底解决Java的值传递和引用传递</a></p>
<p>这篇文章大部分内容我都很认可，但感觉引入了没必要的形参和实参反而导致了理解上的障碍。 参数传递，传递的其实是值的备份。参数分为基本数据类型和引用类型，基本数据类型被存放在虚拟机栈。对基本数据类型的赋值其实是对参数的副本的赋值，不会对基本数据类型有影响。引用类型所引用的对象存在于堆中。一个进程中的所有的线程共享同一个堆，所以只要引用地址相同，同一个进程中的引用对象是唯一的。如果对引用地址的副本进行了修改，只是把副本指向了一个新的对象，而不会对原引用有影响。</p>
<p><strong>第二个例子结果分析</strong></p>
<p><strong>Integer;Float这种基本类型的引用类型又不同于我们自定义的引用类型。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public static void func(Integer a) &#123;</span><br><span class="line">    a &#x3D; 2000;                                 &#x2F;&#x2F;  &lt;3 &gt;</span><br><span class="line">    System.out.println(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Integer a &#x3D; Integer.valueOf(1000);       &#x2F;&#x2F;   &lt;1&gt;     </span><br><span class="line">    func(a);                                &#x2F;&#x2F;  &lt;2 &gt;</span><br><span class="line">    System.out.println(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在&lt;3&gt;，func接收到的参数是值为1000的引用地址，将该参数修改成值为2000。<code>a</code>变成了基本数据类型。原<code>a</code>没有被修改。</p>
<p>那么将第三步修改成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = Integer.valueOf(<span class="number">2000</span>);            &lt;<span class="number">3</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以修改<code>a</code>的值吗？ 在&lt;3&gt;步，a被修改成值为2000的引用地址。原<code>a</code>仍然没有被修改。</p>
<p>我们需要一个不修改引用地址，而是修改引用地址引用的值的方法。</p>
<p>进入到Integer源码看一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**    </span></span><br><span class="line"><span class="comment"> * The value of the &#123;<span class="doctag">@code</span> Integer&#125;.  </span></span><br><span class="line"><span class="comment"> *     * <span class="doctag">@serial</span>   </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现value被设置成了final，也就意味着我们不能修改一个已经存在的Integer对象的值。</p>
<h6 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h6><p>Integer保存一些常用的Integer缓存。这些Integer范围默认是从-128到127。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Integer a = Integer.valueOf(<span class="number">1</span>);</span><br><span class="line">Integer b = Integer.valueOf(<span class="number">1</span>);</span><br><span class="line">System.out.println(a == b);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以及</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Integer a = Integer.valueOf(<span class="number">200</span>);</span><br><span class="line">Integer b = Integer.valueOf(<span class="number">200</span>);</span><br><span class="line">System.out.println(a == b);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果是不同的。</p>
<h3 id="2-字符串常量池"><a href="#2-字符串常量池" class="headerlink" title="2. 字符串常量池"></a>2. 字符串常量池</h3><p>java设计者为了提供性能，为常用的字符串对象设计了字符串常量池。</p>
<h5 id="字符串常量池位置"><a href="#字符串常量池位置" class="headerlink" title="字符串常量池位置"></a>字符串常量池位置</h5><p>根据前文描述， 内存中的堆、虚拟机栈、程数计数器、本地方法栈、方法区。字符串常量池的目的就是减少字符串对象的创建和内存占用。</p>
<p>根据这个逻辑，它应该存在于线程共享区，也就是堆或者方法区中。堆存放的是对象，每个对象都包含一个与之对应的class。字符串常量池存在于方法区中。</p>
<p><strong><a target="_blank" rel="noopener" href="https://github.com/codeAndxv/blog-test/tree/master/src/main/java/com/dudu/constant">例子</a></strong></p>
<h3 id="3-真正的原因"><a href="#3-真正的原因" class="headerlink" title="3. 真正的原因"></a>3. 真正的原因</h3><p>回归正题，在学习了上面两部分知识后，还是没有找到<a target="_blank" rel="noopener" href="https://github.com/codeAndxv/blog-test/blob/master/src/main/java/com/dudu/mutil/unsafe/Test.java">多线程操作例子</a>没有出错原因。</p>
<p>那么换一个运行<code>threa</code>的方法，将例子修改成<a target="_blank" rel="noopener" href="https://github.com/codeAndxv/blog-test/blob/master/src/main/java/com/dudu/mutil/unsafe/CorrectTest.java">CorrectTest</a>，运行，结果不再是<code>0</code>。</p>
<p>思考这两个例子有什么区别呢， 在回顾第一个例子，其实它只是单线程运行的。</p>
<h3 id="4-结论"><a href="#4-结论" class="headerlink" title="4. 结论"></a>4. 结论</h3><p>有段时间没有回顾java基础知识了，犯了很低级的错误。 学习，温故而知新。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/java%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E5%9F%BA%E7%A1%80/" data-id="ckdd5qtio0003gstd8h4c9hyf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-关于技术开发道路的思考" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF%E5%BC%80%E5%8F%91%E9%81%93%E8%B7%AF%E7%9A%84%E6%80%9D%E8%80%83/" class="article-date">
  <time datetime="2020-08-02T13:56:11.365Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2019.10.19</em></p>
<p>本文前半部分讲述如何看待程序员是青春饭，以及这一看法的成因。后半部分提出笔者对这一现象提出的可行思路。</p>
<p><img src="https://img.hacpai.com/bing/20180316.jpg?imageView2/1/w/960/h/540/interlace/1/q/100"> </p>
<p>一直以来，程序员都被认为是吃青春饭的职业。究其原因，一方面是因为开发对身体素质有一定的要求。当项目紧张的时候，你需要有加班的能力。同时开发也是一项脑力劳动，虽然随着这些年技术的不断出现，开发的门槛越来越低，我们都自称为是ctrl-c,ctrl-v程序员。但就最基础的**管理系统来说，也是需要考虑数据构型来设计数据表，考虑各种不正确的数据来保证接口的正确运行。 其二原因，程序开发领域中新知识，新技术的更新换代非常快。各种框架层出不穷。拿我熟悉的java web开发来说，从我大三时候的ssh，到ssm再到现在的springmvc。如果两年你不接触新知识，新技术，可能你掌握的一半的技术都被淘汰。其实这也是程序员自己在淘汰自己。</p>
<p>今天在查看招聘网站的岗位要求时，慢慢发现或者说验证一个结论。你需要打造自己的特长，在某个知识领域a钻研的足够深的基础上，学习其它跟a相关的知识，来让a变得更深。而不能看到什么岗位钱多，就去学。如果你投身于一个与你之前擅长不相关的领域，你就相当于一个初学者。在这个情况下，想要和那些充满斗志和求知欲的年轻人来竞争，最后的结果可想而知。在这个情况下，你之前的知识非但不会是助力反而是累赘。</p>
<p>拿我最近感兴趣的分布式来说，招聘的岗位有分布式存储软件工程师，分布式计算架构师，音视频分布式，分布式后台等等。上面这几个岗位各自特有而我不会的的要求，主要是：熟悉NFS，NAS，HDFS，Cassandra，Redis，Parquet，AVRO, 或者其他分布式文件存储系统及Data Streaming； 有hadoop、Spark、Hive、Presto、Flink、ES、Kylin等开源系统源码分析经验者；系统调度和音视频系统开发经验；熟悉mongodb/mysql/rocksdb等开源存储产品，熟悉kafka/rabbitmq等开源消息队列产品优先。就我目前的情况来说，第四种岗位我达到要求的速度会更快，或者说我现在已经基本满足了。而前面三种，我都需要进一步的学习来达到要求。</p>
<p>你可以发现一个规律，这些岗位，虽然各自有一两条不同的要求，但大多数的要求是相似的。这就是大领域中的各项多样性。如果在分布式这个领域中，你需要转岗，就会比你转前端leader简单的多。</p>
<p>最重要的是，你需要不断的融汇新的知识来保证自己在擅长领域不落伍。虽然开发技术更新换代一直非常快这个事实在某方面让人感到绝望，但我们可以把时间拉伸，放大时间维度来看，会发现技术也不是一下子就替代掉了。而是慢慢的更新换代掉的，无非这个速度较其他岗位更加快罢了。而如果你选择了程序员这个岗位，我认为你应该做好终身学习的准备。</p>
<p>总结：程序员是青春饭这个看法无关对错，看比较哪些岗位。而物竞天择，互联网极大拉低了知识的获取成本，让更多的人在一起竞争，先行者自然会感觉竞争压力。保持自己在某个领域的持久统治力，一深多广是一个不错的思路。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF%E5%BC%80%E5%8F%91%E9%81%93%E8%B7%AF%E7%9A%84%E6%80%9D%E8%80%83/" data-id="ckdd5qtit0006gstd0ysebu03" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-javaCompiler在springboot无法正常运行的爬坑记录" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/javaCompiler%E5%9C%A8springboot%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E8%BF%90%E8%A1%8C%E7%9A%84%E7%88%AC%E5%9D%91%E8%AE%B0%E5%BD%95/" class="article-date">
  <time datetime="2020-08-02T13:55:02.409Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2019.12.08</em></p>
<p>本篇文章介绍在springboot中，使用javaCompiler时，遇到的坑。因为springboot使用的特殊的jar包格式，导致java文件编译以及class文件加载方面的问题。</p>
<p><img src="https://img.hacpai.com/bing/20190322.jpg?imageView2/1/w/960/h/540/interlace/1/q/100"> </p>
<p><em>稍微碎碎念一下，这个问题困扰了我三天。这个问题里面有两个坑，下面慢慢解释</em></p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p><em>abc项目因为某些原因，需要用到动态编译以及动态加载<br>, 所以使用javaCompiler。将java文件动态编译成class文件，然后需要用到class时来动态加载class文件。在windows idea上以main方法运行没问题。</em></p>
<p>javaCompiler相关知识</p>
<h3 id="package-doesnot-exist-cannot-find-symbol-when-compile-java-file"><a href="#package-doesnot-exist-cannot-find-symbol-when-compile-java-file" class="headerlink" title="package doesnot exist cannot find symbol when compile java file"></a>package doesnot exist cannot find symbol when compile java file</h3><p>abc项目在本机运行的很好，应docker趋势，开始构建docker镜像。</p>
<p>写dockerfile文件, 最后一行<code>java -jar projectname.jar</code>&gt;&gt;run docker build in linux。</p>
<p>然后不出意外的报错了。查看日志发现是运行到<code>javac.run()</code>方法时，报<code>package ** doesnot exist</code>。</p>
<p>找一下<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/javac.html">官方文档javac Options</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-cp *path* or -classpath *path*</span><br><span class="line"></span><br><span class="line">    Specifies where to find user class files, and (optionally) annotation processors and source files. This class path overrides the user class path in the &#96;CLASSPATH&#96; environment variable. If neither &#96;CLASSPATH&#96;, &#96;-cp&#96; nor &#96;-classpath&#96; is specified, then the user *class path* is the current directory. See [Setting the Class Path](https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;8&#x2F;docs&#x2F;technotes&#x2F;tools&#x2F;windows&#x2F;classpath.html#CBHHCGFB).</span><br><span class="line">    </span><br><span class="line">    If the &#96;-sourcepath&#96; option is not specified, then the user class path is also searched for source files.</span><br><span class="line">    </span><br><span class="line">    If the &#96;-processorpath&#96; option is not specified, then the class path is also searched for annotation processors.</span><br></pre></td></tr></table></figure>
<p>然后就很简单了，我们把用到的包路径作为<code>-classpath</code>的参数。</p>
<p>还有一点小问题， 我们如何找到用到的包依赖路径。我用了一个比较hack的方法，通过<code>mvn dependency:copy-dependencies</code>把依赖复制到<code>target/dependency</code>这个路径下。通过<code>getLibsPathFromDicPath</code>方法获取到所有依赖包的路径并组合在一起。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private static String getLibsPathFromDicPath(String dicPath) &#123;</span><br><span class="line">      String libSeparator &#x3D; OSValidator.isWindows() ? &quot;;&quot; : &quot;:&quot;;</span><br><span class="line">      File file &#x3D; new File(dicPath);</span><br><span class="line">      StringBuilder stringBuilder &#x3D; new StringBuilder();</span><br><span class="line">      for (File temFile : Objects.requireNonNull(file.listFiles())) &#123;</span><br><span class="line">          stringBuilder.append(temFile.getAbsoluteFile());</span><br><span class="line">          stringBuilder.append(libSeparator);</span><br><span class="line">      &#125;</span><br><span class="line">      stringBuilder.deleteCharAt(stringBuilder.lastIndexOf(libSeparator));</span><br><span class="line">      return stringBuilder.toString();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>我不确定使用<code>ENV CLASSPATH projectDir/target/dependency/</code>这个方法是否可以。我尝试了一下，失败了。不知道是因为这个方法不行还是因为其他什么原因。</p>
<p>问题虽然解决了，但思考为什么在idea运行没有出现这个问题？ 推测应该是idea自动为project设置了classPath以及复制依赖到classPath路径下。</p>
<h5 id="classNotFoundException-when-loadClass"><a href="#classNotFoundException-when-loadClass" class="headerlink" title="classNotFoundException when loadClass"></a>classNotFoundException when loadClass</h5><p>一切都不是一帆风顺的， 当解决完上面的问题，再次尝试，再次出错。 查看日志，发现是在动态加载class文件时报错。思考这些报classNotFoundException的类其实已经被加载了，无论是以jar方式还是以main方式。</p>
<p>但是为什么找不到呢？ 敲敲脑壳，开始搜索classLoader相关知识。</p>
<p>一顿狼吞虎咽的classLoader恶补后，知道了可能导致问题出现的原因。</p>
<ul>
<li>classLoader加载是parent delegate model，parent classLoader first!</li>
<li>父classLoader看不到子classLoader加载的类</li>
<li>springboot使用了自定义的classLoader:LaunchedURLClassLoader， 其父classLoader是AppClassLoader<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; ClassLoader Tree&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">org.springframework.boot.loader.LaunchedURLClassLoader@1218025c</span><br><span class="line">- sun.misc.Launcher$AppClassLoader@6bc7c054</span><br><span class="line">-- sun.misc.Launcher$ExtClassLoader@85ede7b</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>在找一下项目中用到的<code>classLoader</code>，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URLClassLoader classLoader &#x3D; new URLClassLoader(urls);</span><br></pre></td></tr></table></figure>
<p>那么就小小的修改一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URLClassLoader classLoader &#x3D; new URLClassLoader(urls, Thread.currentThread().getContextClassLoader());</span><br></pre></td></tr></table></figure>
<p><code>Thread.currentThread().getContextClassLoader()</code>在jar方式下运行时，值是<code>LaunchedURLClassLoader</code>。</p>
<p>再次构建尝试，一切正常。完美。</p>
<h4 id="附言"><a href="#附言" class="headerlink" title="附言"></a>附言</h4><p>除了通过拷贝依赖到某个路径下，还可以通过自定义JavaFileManager。具体原理是其实在jar方式下，所有的依赖包已经被打包进projectname.jar里面了。</p>
<p>下面简述一下<code>springboot</code>的<code>fat jar</code>。</p>
<p><code>fat jar</code>里面包括了项目的class文件、embed-tomcat、所有的依赖包以及一个可执行脚本。可以直接执行<code>java -jar name.jar</code>来执行。</p>
<p>看一下依赖包的路径:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Spring Boot Application ClassLoader Urls &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  </span><br><span class="line">ClassLoader urls: org.springframework.boot.loader.LaunchedURLClassLoader@4aa298b7  </span><br><span class="line">file:&#x2F;Users&#x2F;hengyunabc&#x2F;code&#x2F;java&#x2F;spring-boot-inside&#x2F;demo-classloader-context&#x2F;target&#x2F;demo&#x2F;BOOT-INF&#x2F;classes&#x2F;  </span><br><span class="line">jar:file:&#x2F;Users&#x2F;hengyunabc&#x2F;code&#x2F;java&#x2F;spring-boot-inside&#x2F;demo-classloader-context&#x2F;target&#x2F;demo&#x2F;BOOT-INF&#x2F;lib&#x2F;bcpkix-jdk15on-1.55.jar!&#x2F;  </span><br><span class="line">jar:file:&#x2F;Users&#x2F;hengyunabc&#x2F;code&#x2F;java&#x2F;spring-boot-inside&#x2F;demo-classloader-context&#x2F;target&#x2F;demo&#x2F;BOOT-INF&#x2F;lib&#x2F;bcprov-jdk15on-1.55.jar!&#x2F;  </span><br><span class="line">jar:file:&#x2F;Users&#x2F;hengyunabc&#x2F;code&#x2F;java&#x2F;spring-boot-inside&#x2F;demo-classloader-context&#x2F;target&#x2F;demo&#x2F;BOOT-INF&#x2F;lib&#x2F;classmate-1.3.3.jar!&#x2F;</span><br></pre></td></tr></table></figure>

<p>如果我们自定义一个javaFileManager来查找到想要的依赖包，就不再需要单独复制依赖包到一个路径。想要实现的可以看一下<a target="_blank" rel="noopener" href="http://atamur.blogspot.com/2009/10/using-built-in-javacompiler-with-custom.html">Using built-in JavaCompiler with a custom classloader</a>。博主尝试了一下，没有成功，因为时间问题没再继续尝试。</p>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>在解决这个问题的整个过程中，我也犯了很多错误。 package doesnot exist 这个错误，我以为是和classLoader这方面有关系。javac.run和javaCompiler.getTask来回的切换尝试等等错误。 本质上还是原理上的不清楚，导致只能不断的尝试。</p>
<p>相关资料链接：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/michaelliao/compiler/issues/5">springboot应用打包后, JavaCompiler无法动态加载类</a></p>
<p><a target="_blank" rel="noopener" href="http://atamur.blogspot.com/2009/10/using-built-in-javacompiler-with-custom.html">Using built-in JavaCompiler with a custom classloader</a></p>
<h5 id="the-links-about-javac"><a href="#the-links-about-javac" class="headerlink" title="the links about javac"></a>the links about javac</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/pengpenglin/article/details/1682858">Java中-classpath和路径的使用</a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2096283/including-jars-in-classpath-on-commandline-javac-or-apt">Including jars in classpath on commandline (javac or apt)</a></p>
<h5 id="the-links-about-javaCompiler"><a href="#the-links-about-javaCompiler" class="headerlink" title="the links about javaCompiler:"></a>the links about javaCompiler:</h5><p><a target="_blank" rel="noopener" href="http://pfmiles.github.io/blog/dynamic-java/">动态的Java - 无废话JavaCompilerAPI中文指南</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ooppookid/article/details/51710981">Java千百问_08JDK详解（008）_通过代码如何编译java文件</a></p>
<p><a target="_blank" rel="noopener" href="https://www.programcreek.com/java-api-examples/?class=javax.tools.JavaCompiler&method=getTask">Java Code Examples for javax.tools.JavaCompiler.<em>getTask()</em></a></p>
<p><a target="_blank" rel="noopener" href="https://dzone.com/articles/how-to-compile-a-class-at-runtime-with-java-8-and">How to Compile a Class at Runtime with Java 8 and 9</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1563909/how-to-set-classpath-when-i-use-javax-tools-javacompiler-compile-the-source">How to set classpath when I use javax.tools.JavaCompiler compile the source?</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/andysd/p/10083760.html">java动态编译 （java在线执行代码后端实现原理）（二）</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/andysd/p/10081443.html">java动态编译 （java在线执行代码后端实现原理）</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.leanote.com/post/medusar/java-Compiler-API">使用java Compiler API编译java文件</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.leanote.com/post/medusar/30d1a37b6154">使用Java Compiler API编译字符串java源码</a></p>
<h5 id="the-links-about-classLoader"><a href="#the-links-about-classLoader" class="headerlink" title="the links about classLoader:"></a>the links about classLoader:</h5><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000013469223">深入理解JVM之ClassLoader</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000013532009">springboot应用启动原理(二) 扩展URLClassLoader实现嵌套jar加载</a></p>
<p><a target="_blank" rel="noopener" href="http://hengyunabc.github.io/spring-boot-classloader/">深入Spring Boot：ClassLoader的继承关系和影响</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/caoyi1207/article/details/80606232">Spring Boot ClassLoader</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/31218636">委派模型与类加载器</a></p>
<h5 id="the-links-about-springboot"><a href="#the-links-about-springboot" class="headerlink" title="the links about springboot"></a>the links about springboot</h5><p><a target="_blank" rel="noopener" href="http://hengyunabc.github.io/spring-boot-application-start-analysis/">spring boot应用启动原理分析</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39716796/spring-boot-executable-jar-with-classpath">Spring Boot Executable Jar with Classpath</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000017748493">运行 Spring Boot 应用的 3 种方式</a></p>
<h5 id="stack-overflow"><a href="#stack-overflow" class="headerlink" title="stack overflow"></a>stack overflow</h5><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/52601788/javacompiler-works-when-running-the-main-method-directly-but-not-when-running-sp">JavaCompiler works when running the main method directly but not when running spring-boot:run</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/46896593/using-javacompiler-api-in-a-spring-boot-app-unable-to-properly-set-the-compila">Using JavaCompiler API in a Spring Boot app - unable to properly set the compilation classpath</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/33573365/why-does-javac-says-package-pkg-name-does-not-exist">Why does JAVAC says, Package <pkg_name> does not exist?</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/12718723/javac-error-package-x-does-not-exist-at-import-x">javac error: “package x does not exist” at “import x”</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/10767048/javacompiler-with-custom-classloader-and-filemanager">JavaCompiler with custom ClassLoader and FileManager</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/javaCompiler%E5%9C%A8springboot%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E8%BF%90%E8%A1%8C%E7%9A%84%E7%88%AC%E5%9D%91%E8%AE%B0%E5%BD%95/" data-id="ckdd5qtin0002gstdekeibr0r" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-api性能优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/02/api%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="article-date">
  <time datetime="2020-08-02T13:53:47.964Z" itemprop="datePublished">2020-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>迁移自原博客 时间 2019.11.16</em></p>
<p>首次的api性能优化，通过使用分离业务逻辑，使用异步线程的方式来提高api性能</p>
<p><img src="https://img.hacpai.com/bing/20180706.jpg?imageView2/1/w/960/h/540/interlace/1/q/100"> </p>
<p><em>组织上又把重要的任务交给我了，依旧是我不熟悉的领域，不过我喜欢。</em></p>
<h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>负责的系统中有一个很重要的上传接口，响应速度一直不理想。<br>虽然花了三天时间，把我所想到的优化，能做的优化都做了一下。但是还是有很大的进步空间，现在的优化结果只能说是勉强可以使用。作为第一次的api性能优化，我还是最胖的。</p>
<h3 id="压测工具"><a href="#压测工具" class="headerlink" title="压测工具"></a>压测工具</h3><ul>
<li>locust  <a target="_blank" rel="noopener" href="https://docs.locust.io/en/stable/quickstart.html">(doc)</a><br>  python领域中的压测工具。需要自己定义request data的生成方式，提供简单的界面</li>
<li>jmeter  <a target="_blank" rel="noopener" href="https://jmeter.apache.org/">(doc)</a><br>  java领域中有名的压测工具，不需要自己写任何的代码，会生成一个html页面</li>
</ul>
<p>通过使用，发现这两个工具的测试结果差不多。 而因为待优化的接口具有数据重复性校验，所以就使用了locust。</p>
<h3 id="优化前后"><a href="#优化前后" class="headerlink" title="优化前后"></a>优化前后</h3><p>优化前提：通过分析业务流程，在尽量不重写代码的情况下，完成性能优化。</p>
<p>优化前：单线程调用：rps为0.8。设置成100线程调用：rps为1.2。<br>多线程完全不能提高api性能？？ 从逻辑上完全讲不通。</p>
<p>作为一个兼职后端开发工程师，首先我从api的业务实现上分析。这个上传接口一次涉及到数据验证，账单计算，余额检测，数据插入，财务扣款。 从结果推测多线程不能提高性能的主要原因是因为数据库锁的原因。余额检测与财务扣款相互排斥，数据验证和数据插入相互排斥。</p>
<p>理清业务逻辑后， 优化就很简单了。 上传接口只负责数据验证和数据插入，剩余的数据插入、账单计算和财务扣款通过一个异步的线程来完成。把剩余部分的任务封装成一个task，并提供一个线程池。</p>
<p>优化后：单线程调用：rps为3。设置成100线程调用： rps可达到15。<br>以上数据是测试本地window所得。如果部署到linux服务器上，性能会有略微提升。</p>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>在优化完接口后，压测工具得到的结果和业务服务耗时时间误差很大。 单线程下，压测工具得到的rt为400ms，而日志打印的业务耗时时间为100ms。</p>
<p>而在我的理解中，业务逻辑已经不能在继续优化。剩下还可做的优化带来的收益很小，甚至可以不做。</p>
<p>于是我猜测，剩下的耗时是建立连接，数据传输的所用耗时。</p>
<p>然后做一个ping接口，单线程的压测结果是rps为50。这也就是说明建立连接以及连接关闭的时间为20ms左右。剩下的可能是数据传输的时间。</p>
<h3 id="可优化点"><a href="#可优化点" class="headerlink" title="可优化点"></a>可优化点</h3><ol>
<li>把接口修改成批量上传接口<br>现在的接口只是接收单条数据。一次调用只能完成一次数据插入。就算是多线程调用，也会有数据库锁等影响性能的因素。如果修改成多条数据接口，性能上会有巨大的提高。</li>
<li>如果修改成批量上传接口，sql语句可以把多条insert语句合成一条来提高insert速度。</li>
<li>client端以及server端联合优化数据传输速度（猜测）</li>
</ol>
<h2 id="2019-10-28日更新"><a href="#2019-10-28日更新" class="headerlink" title="2019.10.28日更新"></a>2019.10.28日更新</h2><h3 id="优化结果不被接受"><a href="#优化结果不被接受" class="headerlink" title="优化结果不被接受"></a>优化结果不被接受</h3><p>rps为3的结果不被满意，被要求继续查看原因。没得办法，继续通过打印所有的日志，从进入业务逻辑之前，到完成业务逻辑之后。通过检查，发现一开始的api耗时为120ms左右，而发现随着时间的推移，api耗时慢慢增加，甚至达到1000ms。</p>
<p>为什么随着时间的推移，api耗时会增加呢？</p>
<p> 而再次回顾我写的代码，将剩余的数据插入、账单计算和财务扣款通过一个异步的线程来完成。<br>而因为数据检查和数据插入这两个阶段比后面三个阶段要快。异步线程越来越多，进而大大消耗服务器的资源和数据库的资源。</p>
<p>猜测到这个原因时，我把异步操作注释掉，只进行数据的检查和数据插入。测试的结果rps达到了8。问题确认无误，就是上面的原因。</p>
<h3 id="处理扣费阶段"><a href="#处理扣费阶段" class="headerlink" title="处理扣费阶段"></a>处理扣费阶段</h3><p>接下来就是如何处理数据插入，账单计算以及账务扣款这三个阶段。前面已经说明了太多线程会大量占用服务器资源，导致正常的api调用变慢甚至失败。<br>所以想到的办法就是使用一个job，使用一个线程来定时的扫描所有需要进行扣款以及数据插入的数据。<br>发现这种定时任务，用的很多。准备做一个类似的组件，是根据生产者消费者来构建的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/02/api%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" data-id="ckdd5qtim0001gstdflvohv7n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/02/%E3%80%8A%E5%A5%87%E5%BC%82%E4%BA%BA%E7%94%9F%E3%80%8B%E6%9C%89%E6%84%9F/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/08/02/%E7%9B%AE%E5%89%8D%E7%9A%84%E5%8F%8D%E6%80%9D%E5%92%8C%E6%9C%AA%E6%9D%A5%E7%9A%84%E8%AE%A1%E5%88%92/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/08/02/spring%20cloud%20gateway%20%E4%BD%BF%E7%94%A8%20nacos%E4%BD%9C%E4%B8%BA%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/08/02/%E9%98%85%E8%AF%BB%E3%80%8A%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81%E3%80%8B%E7%9A%84%E8%8B%A5%E5%B9%B2%E7%BA%AA%E5%BD%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/08/02/2020%E5%B9%B4%E5%B9%B4%E5%88%9D%E9%9A%8F%E6%83%B3%20%E5%85%B3%E4%BA%8E%E7%9B%AE%E5%89%8D%E8%87%AA%E8%BA%AB%E7%8A%B6%E6%80%81%E5%92%8C%E4%BB%A5%E5%90%8E%E7%9A%84%E5%8F%91%E5%B1%95%E7%9A%84%E8%8B%A5%E5%B9%B2%E6%83%B3%E6%B3%95/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>